---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Main from "@/layouts/Main.astro";
import { SITE } from "@/config";
import { getPublicationPath } from "@/utils/getPublicationPath";

const publications = await getCollection("publications");

const sorted = publications
  .slice()
  .sort((a, b) => b.data.pubDatetime.valueOf() - a.data.pubDatetime.valueOf());
---

<Layout
  title={`Publications | ${SITE.title}`}
  description="Research papers and reports."
>
  <Header />
  <Main pageTitle="Publications" pageDesc="Research papers and reports.">
    <div class="app-prose max-w-app">
      <a
        class="font-semibold"
        href="https://scholar.google.com/citations?user=87g_0KgAAAAJ"
        rel="noreferrer"
        target="_blank"
      >
        Google Scholar
      </a>
    </div>

    <ul class="mt-4 space-y-5">
      {
        sorted.map(pub => (
          <li class="app-prose max-w-app">
            <div class="text-sm opacity-75">
              {pub.data.pubDatetime.getFullYear()}
              {pub.data.type ? ` â€” ${pub.data.type}` : ""}
            </div>
            <a
              class="text-base font-semibold"
              href={`${getPublicationPath(pub.id, pub.filePath)}/`}
            >
              {pub.data.title}
            </a>
            {pub.data.authors.length > 0 && (
              <div class="mt-1 text-sm opacity-80">
                {pub.data.authors.join(", ")}
              </div>
            )}
            <div class="mt-2 flex flex-wrap gap-3 text-sm">
              {pub.data.pdfUrl && (
                <a href={pub.data.pdfUrl} rel="noreferrer" target="_blank">
                  PDF
                </a>
              )}
              {pub.data.doiUrl && (
                <a href={pub.data.doiUrl} rel="noreferrer" target="_blank">
                  DOI
                </a>
              )}
            </div>
          </li>
        ))
      }
    </ul>
  </Main>
  <Footer />
</Layout>
